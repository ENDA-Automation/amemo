var i=Symbol("NotFound"),P=1e3,C=60*P,w=60*C,d=24*w,D=7*d;import*as r from"fs";import*as g from"path";var y=class{constructor(e={}){this.opts=e;this.cache={};this.cacheFile=e.path??"cache.json",this.autoSave=e.autoSave??!0;try{if(!r.existsSync(this.cacheFile))return;let t=r.readFileSync(this.cacheFile,"utf8");this.cache=JSON.parse(t)}catch{}}get(e,t){let n=this.cache[e];return n?Date.now()-n.timestamp>t?i:n.value:i}set(e,t){this.cache[e]={timestamp:Date.now(),value:t},this.autoSave&&this.save()}save(){r.mkdirSync(g.dirname(this.cacheFile),{recursive:!0}),r.writeFileSync(this.cacheFile,JSON.stringify(this.cache))}};function b(s,e,t,n,c,a=""){if(n[a])return n[a];let l=new Proxy(s,{get(p,f){let o=a+"/"+f.toString(),m=p[f];if(typeof m=="function"){if(c[o])return c[o];let F=m.bind(p),{defaultExpire:k=1*d,pathExpire:T={},onHit:E=()=>{},onMiss:O=()=>{}}=t,N=T[o]??k,x=function(...u){let h=o+": "+JSON.stringify(u),S=e.get(h,N);if(S!==i)return E(h,u),S;let v=F(...u);return e.set(h,v),O(h,u),v};return c[o]=x,x}return b(p[f],e,t,n,c,o)}});return n[a]=l,l}function Y(s,e={}){let{cacheStore:t=new y}=e;return b(s,t,e,{},{})}export{Y as cacheProxy};
//# sourceMappingURL=index.js.map
