var i=Symbol("NotFound"),N=1e3,C=60*N,D=60*C,l=24*D,R=7*l;import*as r from"fs";import*as b from"path";var y=class{constructor(n={}){this.cache=n}get(n,t){let e=this.cache[n];return e?Date.now()-e.timestamp>t?i:e.value:i}set(n,t){this.cache[n]={timestamp:Date.now(),value:t}}save(){}};var p=class extends y{constructor(t={}){super();this.opts=t;this.cacheFile=t.path??"cache.json",this.autoSave=t.autoSave??!0;try{if(!r.existsSync(this.cacheFile))return;let e=r.readFileSync(this.cacheFile,"utf8");super.cache=JSON.parse(e)}catch{}}set(t,e){super.set(t,e),this.autoSave&&this.save()}async save(){for(let[t,e]of Object.entries(this.cache))e.value instanceof Promise&&(this.cache[t].value=await e.value);r.mkdirSync(b.dirname(this.cacheFile),{recursive:!0}),r.writeFileSync(this.cacheFile,JSON.stringify(this.cache))}};function k(s,n,t,e,c,a=""){if(e[a])return e[a];let m=new Proxy(s,{get(f,d){let o=a+"/"+d.toString(),x=f[d];if(typeof x=="function"){if(c[o])return c[o];let F=x.bind(f),{defaultExpire:T=1*l,pathExpire:E={},onHit:O=()=>{},onMiss:P=()=>{}}=t,w=E[o]??T,S=function(...u){let h=o+": "+JSON.stringify(u),v=n.get(h,w);if(v!==i)return O(h,u),v;let g=F(...u);return n.set(h,g),P(h,u),g};return c[o]=S,S}return k(f[d],n,t,e,c,o)}});return e[a]=m,m}function q(s,n={}){let{cacheStore:t=new p}=n;return k(s,t,n,{},{})}export{q as cacheProxy};
//# sourceMappingURL=index.js.map
