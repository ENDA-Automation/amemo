var i=Symbol("NotFound"),C=1e3,N=60*C,j=60*N,l=24*j,D=7*l;function d(s,r,t,e,c,a=""){if(e[a])return e[a];let S=new Proxy(s,{get(y,x){let n=a+"/"+x.toString(),u=y[x];if(typeof u=="function"){if(c[n])return c[n];let F=u.bind(y),{defaultExpire:O=1*l,pathExpire:T={},onHit:E=()=>{},onMiss:P=()=>{}}=t,w=T[n]??O,v=function(...p){let f=n+": "+JSON.stringify(p),b=r.get(f,w);if(b!==i)return E(f,p),b;let g=F(...p);return r.set(f,g),P(f,p),g};return c[n]=v,v}return u instanceof Object?d(y[x],r,t,e,c,n):u}});return e[a]=S,S}import*as o from"fs";import*as k from"path";var h=class{constructor(r={}){this.cache=r}get(r,t){let e=this.cache[r];return e?Date.now()-e.timestamp>t?i:e.value:i}set(r,t){this.cache[r]={timestamp:Date.now(),value:t}}save(){}};var m=class extends h{constructor(t={}){super();this.opts=t;this.cacheFile=t.path??".amemo.json",this.autoSave=t.autoSave??!0;try{if(!o.existsSync(this.cacheFile))return;let e=o.readFileSync(this.cacheFile,"utf8");super.cache=JSON.parse(e)}catch{}}set(t,e){super.set(t,e),this.autoSave&&this.save()}async save(){for(let[t,e]of Object.entries(this.cache))e.value instanceof Promise&&(this.cache[t].value=await e.value);o.mkdirSync(k.dirname(this.cacheFile),{recursive:!0}),o.writeFileSync(this.cacheFile,JSON.stringify(this.cache))}};function G(s,r={}){let{cacheStore:t=new m}=r;return d(s,t,r,{},{})}export{l as DAY,m as FileCacheStore,j as HOUR,N as MINUTE,h as MemCacheStore,i as NotFound,C as SECOND,D as WEEK,G as amemo,d as createProxy};
//# sourceMappingURL=index.js.map
