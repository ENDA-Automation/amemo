var F=class{},u=Symbol("NotFound"),M=1e3,C=60*M,j=60*C,b=24*j,D=7*b;function S(s,n,e,t,m,c=""){if(t[c])return t[c];if(typeof s=="function"){let l=c+"/"+s.name,a=(...r)=>{let i=l+": "+JSON.stringify(r.map(p=>p===void 0?"undefined":p===null?"null":p)),y=n.get(i,e.defaultExpire??1*b);if(y!==u)return e.onHit?.(i,r),y;let h=s(...r);return n.set(i,h),e.onMiss?.(i,r),h};return t[c]=a,a}let k=new Proxy(s,{get(l,a){let r=c+"/"+a.toString(),i=l[a];if(typeof i=="function"){if(m[r])return m[r];let y=i.bind(l),{defaultExpire:h=1*b,pathExpire:p={},onHit:E=()=>{},onMiss:P=()=>{}}=e,N=p[r]??h,v=function(...x){let d=r+": "+JSON.stringify(x),g=n.get(d,N);if(g!==u)return E(d,x),g;let w=y(...x);return n.set(d,w),P(d,x),w};return m[r]=v,v}return i instanceof Object?S(l[a],n,e,t,m,r):i}});return t[c]=k,k}var f=class{constructor(n={}){this.cache=n}get(n,e){let t=this.cache[n];return t?Date.now()-t.timestamp>e?u:t.value:u}set(n,e){this.cache[n]={timestamp:Date.now(),value:e}}save(){}clear(){this.cache={}}};import*as o from"fs";import*as T from"path";var O=class extends f{constructor(e={}){super();this.opts=e;this.cacheFile=e.path??".amemo.json",this.autoSave=e.autoSave??!0;try{if(!o.existsSync(this.cacheFile))return;let t=o.readFileSync(this.cacheFile,"utf8");super.cache=JSON.parse(t)}catch{}}set(e,t){super.set(e,t),this.autoSave&&this.save()}async save(){for(let[e,t]of Object.entries(this.cache))t.value instanceof Promise&&(this.cache[e].value=await t.value);o.mkdirSync(T.dirname(this.cacheFile),{recursive:!0}),o.writeFileSync(this.cacheFile,JSON.stringify(this.cache))}clear(){super.clear(),o.unlinkSync(this.cacheFile)}};function Q(s,n={}){let{cacheStore:e=new f}=n;return S(s,e,n,{},{})}export{F as CacheStore,b as DAY,O as FileCacheStore,j as HOUR,C as MINUTE,f as MemCacheStore,u as NotFound,M as SECOND,D as WEEK,Q as amemo,S as createProxy};
